#!/bin/bash

img="/tmp/i3lock-blur.png"
lock="$HOME/.local/share/lock.png"

[[ $(identify $lock) =~ ([0-9]+)x([0-9]+) ]]
img_width=${BASH_REMATCH[1]}
img_height=${BASH_REMATCH[2]}

rm -f $img
scrot -z $img
convert $img -scale 2.5% -resize 4000% $img

while read line; do
    if [[ $line =~ ([0-9]+)x([0-9]+)\+([0-9]+)\+([0-9]+) ]]; then
        width=${BASH_REMATCH[1]}
        height=${BASH_REMATCH[2]}
        x=${BASH_REMATCH[3]}
        y=${BASH_REMATCH[4]}
        pos_x=$((x+width/2-img_width/2))
        pos_y=$((y+height/2-img_height/2))
        add_lock="$add_lock $lock -geometry +$pos_x+$pos_y -composite"
    fi
done <<< $(xrandr)
convert $img $add_lock $img

i3lock -i $img "$@"
