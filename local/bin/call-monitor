#!/bin/bash

# Apps that we don't care if they record
WHITELIST='["parec", "wf-recorder3"]'

apps_recording(){
    #cat ./source_outputs.json |\
    pactl -f json list source-outputs | \
        jq --exit-status \
            --raw-output \
            --argjson wl "$WHITELIST" \
            '.[].properties["application.name"] | select(. != null and ([. == $wl[]] | any | not))'

}

# subscribe to pactl events and runs the check for every change
stdbuf -oL pactl subscribe |
    grep --line-buffered 'source-output' |
    while read line; do
        if apps_recording; then
            notify-send "call mode on"
        else
            notify-send "call mode off"
        fi
    done
